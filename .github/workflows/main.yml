name: Windows - RDP via Playit

on:
  workflow_dispatch:

jobs:
  connect:
    runs-on: windows-latest
    timeout-minutes: 99999999999999999999999999999999

    steps:
      - name: âœ… ØªÙØ¹ÙŠÙ„ RDP
        run: |
          Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

      - name: ðŸ“¥ ØªØ­Ù…ÙŠÙ„ Playit Agent
        run: |
          Invoke-WebRequest -Uri "https://github.com/playit-cloud/playit-agent/releases/latest/download/playit-windows.exe" -OutFile "playit.exe"
          Invoke-WebRequest -Uri "https://yourdomain.com/playit.toml" -OutFile "playit.toml"

      - name: ðŸš€ ØªØ´ØºÙŠÙ„ Playit
        run: ./playit.exe serve --config playit.toml

      - name: ðŸ•’ Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ø¬Ù‡Ø§Ø² ÙŠØ¹Ù…Ù„
        run: |
          echo :loop > loop.bat
          echo timeout /t 60 >> loop.bat
          echo goto loop >> loop.bat
          cmd /c loop.bat
